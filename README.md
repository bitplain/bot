# Модульный Telegram-бот (пример)

Пример минималистичного, но расширяемого Telegram-бота на `aiogram 3`, который
реализует первый модуль — базу знаний сотрудников. Архитектура допускает
простое подключение/отключение модулей через конфигурацию.

## Структура проекта
```
.
├── app
│   ├── core
│   │   ├── db.py              # Инициализация БД и фабрика сессий
│   │   ├── loader.py          # Создание экземпляров Bot/Dispatcher
│   │   └── modules.py         # Подключение модулей по конфигурации
│   ├── models
│   │   ├── __init__.py
│   │   └── knowledge_base.py  # ORM-модель Employee
│   └── modules
│       ├── __init__.py
│       └── knowledge_base
│           ├── __init__.py
│           └── handlers.py    # FSM-диалог /add для добавления записи
├── config.py                  # Настройки (token, БД, список модулей)
├── main.py                    # Точка входа бота
├── requirements.txt
└── README.md
```

## Установка и запуск
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Создайте файл `.env` или экспортируйте переменную окружения с токеном бота:
   ```bash
   echo "BOT_TOKEN=ВАШ_ТОКЕН" > .env
   # при необходимости задайте нестандартный путь к БД
   # echo "DATABASE_URL=sqlite+aiosqlite:///./knowledge.db" >> .env
   ```
3. Запустите бота:
   ```bash
   python main.py
   ```
   При первом старте будут созданы таблицы в SQLite (файл `knowledge.db`).

## Конфигурация модулей
В `config.py` параметр `enabled_modules` задает список активных модулей.
По умолчанию включен только `knowledge_base`. Чтобы подключить новый модуль,
добавьте его имя в список — остальной код изменять не нужно.

## Функционал модуля базы знаний
- Команды `/add` или `/добавить` запускают пошаговый диалог сбора данных:
  фамилия, имя, отчество (опционально), телефон, email, должность, отдел.
- Для телефона и email выполняется валидация формата.
- Данные сохраняются в базу с обработкой ошибок сохранения.

## Расширяемость
- Шаблон подключения новых модулей — в `app/core/modules.py`.
- Каждый модуль предоставляет функцию `setup(dispatcher)`, где регистрирует свои роутеры.
- Для примера поиска можно создать `app/modules/search/handlers.py` с функцией `setup`
  и добавить `"search"` в список `enabled_modules`.

## Примечания
- ORM: `SQLAlchemy 2.x` (async, SQLite). Для миграции на PostgreSQL/MySQL
  измените `DATABASE_URL` — остальной код останется прежним.
- FSM: `aiogram 3`.
- Код снабжен комментариями на русском языке для быстрого погружения.
